function TP(Pos)
    local player = game.Players.LocalPlayer
    if player and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        player.Character.HumanoidRootPart.CFrame = Pos
    end
end

local Monfolder = workspace.Monster:FindFirstChild("Mon")
if not Monfolder then return end

 for _, enemy in ipairs(monfolder:GetChildren()) do
        if enemy:IsA("Model") and enemy:FindFirstChild("Head") then
            local head = enemy.Head
            local distance = (head.Position - rootPart.Position).Magnitude
            if distance <= 60 then -- ตรวจสอบว่าศัตรูอยู่ในระยะ 60 หน่วย
                pcall(function()
                    head:SetAttribute("Hidden", true)
                end)

function Attack()
    while _G.AutoFarm do
        local args = {
            [1] = "FS_None_M1"
        }
        game:GetService("ReplicatedStorage"):WaitForChild("Chest"):WaitForChild("Remotes"):WaitForChild("Functions"):WaitForChild("SkillAction"):InvokeServer(unpack(args))
        task.wait(0.5)
    end
end

function Checkquest()
    local args = {
        [1] = "take",
        [2] = "Kill 4 Soldiers"
    }
    game:GetService("ReplicatedStorage"):WaitForChild("Chest"):WaitForChild("Remotes"):WaitForChild("Functions"):WaitForChild("Quest"):InvokeServer(unpack(args))
end

_G.AutoFarm = true

while task.wait() do
    pcall(function()
        if _G.AutoFarm then
            local target = nil

            -- วนหาเป้าหมายใหม่เรื่อย ๆ ถ้ายังไม่มี
            repeat
                for _, v in pairs(Monfolder:GetChildren()) do
                    if v.Name == "Soldier [Lv. 1]" then
                        local humanoid = v:FindFirstChild("Humanoid")
                        local hrp = v:FindFirstChild("HumanoidRootPart")
                        if humanoid and humanoid.Health > 0 and hrp then
                            target = v
                            break -- เจอมอนแล้วออกจาก loop ทันที
                        end
                    end
                end
                task.wait(0.1) -- รอให้มอนเกิดใหม่
            until target or not _G.AutoFarm

            -- ถ้าเจอมอนแล้ว เข้าโจมตี
            if target then
                local humanoid = target:FindFirstChild("Humanoid")
                local hrp = target:FindFirstChild("HumanoidRootPart")

                if humanoid and humanoid.Health > 0 and hrp then
                    -- ล็อคมอนไม่ให้ขยับ
                    hrp.Anchored = true

                    -- วาร์ปไปหามอน
                    TP(hrp.CFrame * CFrame.new(0, 0, 6))

                    -- โจมตีจนกว่ามอนจะตาย
                    repeat
                        Attack()
                        task.wait(0.1)
                    until not _G.AutoFarm or humanoid.Health <= 0

                    -- ปลดล็อคมอนเมื่อตาย
                    hrp.Anchored = false
                end
            end
        end
    end)
end
